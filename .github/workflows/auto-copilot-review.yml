# GitHub Actions Workflow: Auto Request Copilot Review
# 
# This workflow automatically requests a GitHub Copilot review whenever a new
# pull request is opened. This ensures all PRs get automated feedback.
#
# Learn more about GitHub Actions:
# https://docs.github.com/en/actions

name: Auto Request Copilot Review

# TRIGGER: When does this workflow run?
# This workflow runs when pull request events occur
on:
  pull_request:
    types: 
      - opened      # When a PR is first created
      - reopened    # When a closed PR is reopened
      - synchronize # When new commits are pushed to the PR

# PERMISSIONS: What can this workflow do?
# These permissions are needed to interact with pull requests
permissions:
  contents: read        # Read repository contents
  pull-requests: write  # Write to PRs (needed to request reviews)

# JOBS: What tasks should run?
# Jobs run in parallel by default, but we only have one job here
jobs:
  request-copilot-review:
    name: Request Copilot Review
    
    # RUNNER: Where does this job run?
    # GitHub provides free hosted runners (Ubuntu, Windows, macOS)
    runs-on: ubuntu-latest
    
    # STEPS: Sequential tasks within this job
    steps:
      # Step 1: Checkout the repository code
      # This action (actions/checkout) is provided by GitHub
      - name: Checkout code
        uses: actions/checkout@v4
        
      # Step 2: Request Copilot review using GitHub CLI
      # The GitHub CLI (gh) is pre-installed on GitHub runners
      - name: Request GitHub Copilot Review
        env:
          # GITHUB_TOKEN is automatically provided by GitHub Actions
          # It has the permissions we specified above
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Use GitHub CLI to request a Copilot review
          # ${{ github.event.pull_request.number }} gets the PR number from the event
          gh pr review ${{ github.event.pull_request.number }} \
            --copilot \
            --repo ${{ github.repository }}
          
          echo "âœ… Copilot review requested for PR #${{ github.event.pull_request.number }}"
      
      # Step 3: Add a comment to the PR (optional)
      - name: Add comment to PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr comment ${{ github.event.pull_request.number }} \
            --repo ${{ github.repository }} \
            --body "ðŸ¤– GitHub Copilot has been automatically requested to review this PR."
